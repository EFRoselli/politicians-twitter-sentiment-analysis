<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hello World!</title>
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400italic,400,700' rel='stylesheet' type='text/css'>
  <link href='http://grommet.io/assets/latest/css/grommet.min.css' rel='stylesheet' type='text/css'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.2/react.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.2/react-dom.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
  <script src="http://grommet.io/assets/latest/grommet.min.js"></script>
</head>
<body>
  <!-- <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script> -->
  <script src="/socket.io/socket.io.js"></script>
  <div id="content"></div>
  <script type="text/babel">

  var socket = io();

  var SentimentMeters = React.createClass({

    getInitialState: function() {
      return {user: "", number: 0};
    },

    componentDidMount: function () {
      socket.on('message', function(msg){
        console.log(msg);
        this.setState({user: msg.user, number: msg.number});
      }.bind(this));
    },

    render: function () {
      return (
        <div className="messages">
          <Grommet.Meter legend={{"total": false}} series={[
            {"label": this.state.user, "value": this.state.number, "colorIndex": "graph-1"},
            {"label": "Update counter from websocket 2", "value": 200, "colorIndex": "graph-2"},
            {"label": "Update counter from websocket 3", "value": 100, "colorIndex": "graph-3"},
          ]} vertical={true} />
        </div>
      );
    }
  });

  // _onMessageReceived: function (msg) {
  //     console.log(msg);
  //     this.setState({user: msg.user});
  // },

  //   componentDidMount: function () {
  //     socket.on('message', this.__onMessageReceived);
  //   },
  //
  //   render: function () {
  //     return (
  //       <div className="messages">
  //         <Grommet.Meter legend={{"total": false}} series={[
  //           {"label": this.state.user, "value": 50, "colorIndex": "graph-1"},
  //           {"label": "Update counter from websocket 2", "value": 200, "colorIndex": "graph-2"},
  //           {"label": "Update counter from websocket 3", "value": 100, "colorIndex": "graph-3"},
  //         ]} vertical={true} />
  //       </div>
  //     );
  //   }

  // });

    var App = React.createClass({
      render: function() {
        return (
          <Grommet.App>
            <Grommet.Header direction="row" justify="between" large={true} pad={{horizontal: 'medium'}}>
              <Grommet.Title>Hello World</Grommet.Title>
            </Grommet.Header>
            <Grommet.Section pad={{horizontal: 'medium'}}>
              <SentimentMeters />
            </Grommet.Section>
          </Grommet.App>
        );
      }
    });

    var element = document.getElementById('content');
    ReactDOM.render(React.createElement(App), element);
  </script>
</body>
</html>
